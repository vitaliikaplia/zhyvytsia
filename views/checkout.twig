{% extends "base.twig" %}

{% block content %}

{% if user %}
    {% set first_name = user.first_name %}
    {% set last_name = user.last_name %}
    {% set user_phone = user.user_phone %}
    {% set user_email = user.user_email %}
    {% set user_region = user.user_region %}
    {% set user_city = user.user_city %}
    {% set user_zip = user.user_zip %}
    {% set user_address = user.user_address %}
    {% set user_np_city_ref = user.user_np_city_ref %}
    {% set user_np_city_name = user.user_np_city_name %}
    {% set user_np_office_number = user.user_np_office_number %}
    {% set user_np_office_name = user.user_np_office_name %}
    {% set user_pickup_point = user.user_pickup_point %}
    {% if user.delivery_type %}
        {% set delivery_type = user.delivery_type %}
    {% else %}
        {% set delivery_type = "up" %}
    {% endif %}
{% else %}
    {% set delivery_type = "up" %}
{% endif %}

<div class="checkoutWrapper">
    <div class="checkout">
        <form method="post" action="?checkout=go" class="orderColumns{% if items and items is iterable %} show{% endif %}">
            <div class="col">
                <h3 class="title">üõí {{ __('Check your order', TEXTDOMAIN) }}</h3>
                {% if items and items is iterable %}
                <div class="positionsWrapper">
                    {% include 'overall/positions.twig' %}
                </div>
                {% endif %}
                <h3 class="title">ü™™ {{ __('Enter your information', TEXTDOMAIN) }}</h3>
                <div class="informationWrapper">
                    <label>
                        <p class="label">{{ __('First Name', TEXTDOMAIN) }}:</p>
                        <input type="text" name="f_name" value="{{ first_name }}">
                    </label>
                    <label>
                        <p class="label">{{ __('Last Name', TEXTDOMAIN) }}:</p>
                        <input type="text" name="l_name" value="{{ last_name }}">
                    </label>
                    <label>
                        <p class="label">{{ __('Phone', TEXTDOMAIN) }}:</p>
                        <input type="text" name="user_phone" value="{{ user_phone }}" class="user_phone">
                    </label>
                    <label>
                        <p class="label">{{ __('Email', TEXTDOMAIN) }}:</p>
                        <input type="email" value="{{ user_email }}">
                    </label>
                </div>
            </div>
            <div class="col">
                <h3 class="title">üì¶ {{ __('Choose the type of delivery', TEXTDOMAIN) }}</h3>
                <div class="deliveryTypeWrapper">
                    {% if general_fields.shop.enable_simple_address %}
                    <label>
                        {{ general_fields.shop.ukrposhta_logo | picture }}
                        <input type="radio" name="delivery_type" value="up"{% if delivery_type == 'up' %} checked{% endif %}>
                        <span class="checked"></span>
                    </label>
                    {% endif %}
                    {% if general_fields.shop.enable_nova_poshta_office %}
                    <label>
                        {{ general_fields.shop.nova_poshta_logo | picture }}
                        <input type="radio" name="delivery_type" value="np"{% if delivery_type == 'np' %} checked{% endif %}>
                        <span class="checked"></span>
                    </label>
                    {% endif %}
                    {% if general_fields.shop.enable_self_pickup_points %}
                    <label>
                        {{ general_fields.shop.self_pickup_logo | picture }}
                        <p class="label">{{ __('Pickup', TEXTDOMAIN) }}</p>
                        <input type="radio" name="delivery_type" value="pu"{% if delivery_type == 'pu' %} checked{% endif %}>
                        <span class="checked"></span>
                    </label>
                    {% endif %}
                </div>
                {% if general_fields.shop.enable_simple_address %}
                <h3 class="title upTitle{% if delivery_type == 'up' %} show{% endif %}">üéÅ {{ __('Enter your address', TEXTDOMAIN) }}</h3>
                <div class="upWrapper{% if delivery_type == 'up' %} show{% endif %}">
                    <label>
                        <p class="label">{{ __('Region (for example, Kyivska, Lvivska, etc.)', TEXTDOMAIN) }}:</p>
                        <input type="text" name="region" value="{{ user_region }}">
                    </label>
                    <label>
                        <p class="label">{{ __('City (or settlement)', TEXTDOMAIN) }}:</p>
                        <input type="text" name="city" value="{{ user_city }}">
                    </label>
                    <label>
                        <p class="label">{{ __('ZIP Code', TEXTDOMAIN) }}:</p>
                        <input type="text" name="zip" value="{{ user_zip }}">
                    </label>
                    <label>
                        <p class="label">{{ __('Address (street, house, apartment)', TEXTDOMAIN) }}:</p>
                        <input type="text" name="address" value="{{ user_address }}">
                    </label>
                </div>
                {% endif %}
                {% if general_fields.shop.enable_nova_poshta_office %}
                <h3 class="title smaller npTitle{% if delivery_type == 'np' %} show{% endif %}">üéÅ {{ __('Select the Nova Poshta office', TEXTDOMAIN) }}</h3>
                <div class="npWrapper{% if delivery_type == 'np' %} show{% endif %}">
                    <label>
                        <p class="label">{{ __('City or settlement', TEXTDOMAIN) }}:</p>
                        <select id="citySearch" name="user_np_city_ref">
                            {% if user_np_city_ref and user_np_city_name %}
                            <option value="{{ user_np_city_ref }}" selected>{{ user_np_city_name }}</option>
                            {% endif %}
                        </select>
                    </label>
                    <input type="hidden" name="user_np_city_name" value="{% if user_np_city_name %}{{ user_np_city_name }}{% endif %}">
                    <label>
                        <p class="label">{{ __('Post office number', TEXTDOMAIN) }}:</p>
                        <select id="postOfficeNumberSearch" name="user_np_office_number"{% if not user_np_city_ref and not user_np_city_name and not user_np_office_number and not user_np_office_name %} disabled{% endif %}>
                            {% set offices = user_np_city_ref | np_get_offices_by_city_ref %}
                            {% if offices is iterable %}
                            {% for val in offices %}
                            <option value="{{ val.id }}"{% if user_np_office_number == val.id and user_np_office_name == val.text %} selected="selected"{% endif%}>{{ val.text }}</option>
                            {% endfor %}
                            {% endif %}
                        </select>
                    </label>
                    <input type="hidden" name="user_np_office_name" value="{% if user_np_office_name %}{{ user_np_office_name }}{% endif %}">
                </div>
                {% endif %}
                {% if general_fields.shop.enable_self_pickup_points %}
                <h3 class="title puTitle{% if delivery_type == 'pu' %} show{% endif %}">üéÅ {{ __('Select pickup office', TEXTDOMAIN) }}</h3>
                <div class="puWrapper{% if delivery_type == 'pu' %} show{% endif %}">
                    {% if general_fields.shop.self_pickup_points is iterable %}
                    <p class="label">{{ __('Pickup point', TEXTDOMAIN) }}:</p>
                    <select id="selfPickupPoints">
                        <option value=""></option>
                        {% for key,val in general_fields.shop.self_pickup_points %}
                        {% set point = 'point-'~(key+1) %}
                        <option value="{{ point }}"{% if user_pickup_point == point %} selected="selected"{% endif%}>{{ val.name }}</option>
                        {% endfor %}
                    </select>
                    {% for key,val in general_fields.shop.self_pickup_points %}
                    {% set point = 'point-'~(key+1) %}
                    <div class="selfPickupPointInfo {{ point }}{% if user_pickup_point == point %} show{% endif%}">
                        <div class="lines">
                            <div class="line">
                                <p class="label">{{ __('Working hours', TEXTDOMAIN) }}:</p>
                                <p class="value">{{ __('From', TEXTDOMAIN) }} <b>{{ val.from_time }}</b> {{ __('to', TEXTDOMAIN) }} <b>{{ val.to_time }}</b></p>
                            </div>
                            <div class="line">
                                <p class="label">{{ __('Working days', TEXTDOMAIN) }}:</p>
                                <p class="value">{{ val.days | render_working_days }}</p>
                            </div>
                            <div class="line">
                                <p class="label">{{ __('Address', TEXTDOMAIN) }}:</p>
                                <p class="value">{{ val.address.address }}</p>
                            </div>
                        </div>
                        <div class="map" data-lat="{{ val.address.lat }}" data-lng="{{ val.address.lng }}" data-address="{{ val.address.address }}"></div>
                    </div>
                    {% endfor %}
                    {% endif %}
                </div>
                {% endif %}
            </div>
        </form>
        <div class="noOrder{% if not items and items is not iterable %} show{% endif %}">
            <h3 class="title">{{ __('Your cart is empty', TEXTDOMAIN) }}</h3>
            <div class="buttons">
                <p class="overallButton green inline">
                    <a href="{{ site.url }}">
                        <span>{{ __("Back to home page", TEXTDOMAIN) }}</span>
                    </a>
                </p>
            </div>
        </div>
    </div>
</div>

{% endblock %}
